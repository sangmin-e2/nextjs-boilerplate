# My 다이어리 (My Diary) - Requirements (v1.0.0)

작성일: 2026-01-01  
목표: 개인 PC에서만 동작하는 로컬 기반 다이어리 앱. 날짜별 기록을 작성하고, 날짜 기반 동적 테마를 적용하며, TSV 파일로 영구 저장한다.

---

## 1. 범위(Scope)

### 1.1 포함(In Scope)
- 날짜 선택 후 다이어리 작성(제목/내용)
- 날짜 기반 동적 테마(배경/텍스트 자동 조합)
- 로컬 파일 시스템에 TSV로 영구 저장(추가/수정)
- 데스크톱 앱 형태로 실행(웹 서비스 배포 아님)

### 1.2 제외(Out of Scope, v1.0)
- 서버/계정/로그인/동기화
- 다이어리 목록/검색/필터/태그
- 이미지/파일 첨부
- 암호화(추후 확장 고려)

---

## 2. 플랫폼 및 아키텍처(확정)

### 2.1 실행 형태
- **Electron 기반 데스크톱 앱(Windows 우선)**
- UI: React + Vite (또는 동급 SPA)
- 파일 저장: Electron Main Process에서 Node.js `fs`로 처리(브라우저 제한 회피)

### 2.2 데이터 저장 위치(기본값)
- 기본 폴더: `문서\GaengniDiary\`
- 기본 파일: `문서\GaengniDiary\diary.tsv`
- 폴더/파일이 없으면 앱이 자동 생성한다.

> 추후 확장(옵션): 설정에서 저장 위치 변경 가능(기본은 문서 폴더 유지)

---

## 3. 핵심 사용자 시나리오(User Stories)

1) 사용자는 날짜를 선택하고 제목/내용을 입력한 뒤 저장한다.  
2) 앱은 선택한 날짜(yyyyMMdd)에 기반해 항상 동일한 테마 색상을 보여준다.  
3) 앱은 저장 시 로컬 TSV 파일에 기록을 영구 저장한다.  
4) 사용자가 같은 날짜를 다시 선택하면, 기존에 저장된 제목/내용이 로딩되어 수정 후 저장할 수 있다.

---

## 4. 기능 요구 사항(Functional Requirements)

### 4.1 다이어리 작성/편집
- 날짜 선택기(Date Picker)를 제공한다.
- 제목 입력(Text Field), 내용 입력(Textarea)을 제공한다.
- 저장 버튼 클릭 시 다음 동작을 수행한다:
  - 입력값 검증(4.1.1)
  - 메모리 데이터 갱신(해당 날짜가 있으면 덮어쓰기, 없으면 추가)
  - TSV 파일에 저장(4.3)

#### 4.1.1 입력 검증 규칙
- 날짜는 필수.
- 제목은 선택(빈 값 허용) 또는 최소 0~200자(프로덕트 정책으로 선택)  
- 내용은 선택(빈 값 허용) 또는 최소 0~20,000자(프로덕트 정책으로 선택)
- 저장 실패 시 사용자에게 오류 메시지를 표시한다.

### 4.2 동적 테마 생성(날짜 기반)
- 선택한 날짜를 `yyyyMMdd` 문자열로 변환한다.
- 해당 문자열을 기반으로 “항상 동일한” 배경색을 생성한다.
- 배경색의 명도(Luminance)를 계산하여 텍스트 색상을 자동 결정한다:
  - 배경이 밝으면 어두운 텍스트
  - 배경이 어두우면 밝은 텍스트
- 동일 날짜는 항상 동일한 배경/텍스트 조합이어야 한다(결정적/Deterministic).

#### 4.2.1 색상 생성 알고리즘 요구
- 입력: `dateKey = yyyyMMdd`
- 처리:
  - `dateKey`를 해시(예: 간단한 32-bit hash)하여 HSL 또는 RGB 범위로 매핑
  - 너무 극단적인 색(너무 흰색/검정)에 치우치지 않도록 채도/명도 범위를 제한
- 출력:
  - `backgroundColor`
  - `textColor` (명도 기반 자동 선택)

### 4.3 데이터 저장(TSV) — 영구 저장
- 저장 포맷: TSV(Tab-Separated Values)
- 인코딩: UTF-8
- 파일 구조:

  헤더(1행) 고정:
  - `date<TAB>title<TAB>content`

  데이터 행:
  - `yyyyMMdd<TAB>제목<TAB>내용`

#### 4.3.1 저장 규칙(중요)
- 같은 날짜(`yyyyMMdd`)가 이미 존재하면 **해당 행을 갱신(덮어쓰기)** 한다.
- 존재하지 않으면 **새 행을 추가**한다.
- 데이터 정렬은 기본적으로 날짜 오름차순(권장) 또는 입력 순서(정책 택1)  
  - v1.0 정책: **날짜 오름차순으로 저장**(diff/백업/검증이 쉬움)

#### 4.3.2 TSV 필드 이스케이프 규칙(필수)
TSV는 탭/개행이 구조를 깨므로 다음 규칙을 적용한다.
- 제목/내용에서:
  - 탭 `\t` → `\\t`
  - 개행 `\n` → `\\n`
  - 캐리지리턴 `\r` → `\\r`
  - 역슬래시 `\` → `\\` (먼저 처리)
- 로딩 시 위 변환을 역변환하여 원문을 복원한다.

#### 4.3.3 원자적 저장(파일 손상 방지)
- 저장 시 임시 파일에 먼저 쓴 후(예: `diary.tsv.tmp`)
- 성공하면 기존 파일을 교체(rename)한다.
- 실패하면 기존 파일은 유지되어야 한다.

#### 4.3.4 백업(권장)
- 저장 직전 기존 파일을 최대 N개 백업으로 보관한다.
  - 예: `diary_YYYYMMDD_HHMMSS.bak.tsv`
  - v1.0 기본 N=5

### 4.4 앱 시작 시 로딩
- 앱 실행 시 `diary.tsv`가 존재하면:
  - 헤더를 확인하고 파싱하여 메모리(Map<date, entry>)로 로딩한다.
- 파일이 없으면:
  - 폴더/파일을 생성하고 기본 헤더를 기록한다.
- 파싱 오류 시:
  - 사용자에게 알림 + 백업 파일 생성 + 안전 모드로 신규 파일 생성(정책)

---

## 5. 사용자 인터페이스(UI/UX)

### 5.1 메인 화면 구성
- Date Picker
- 제목 입력 필드
- 내용 Textarea(자동 높이 또는 스크롤)
- 저장 버튼
- 상태 표시(저장 성공/실패, 마지막 저장 시각)

### 5.2 테마 적용
- 화면 배경은 선택 날짜 기반 배경색
- 텍스트/버튼/아이콘은 자동 선택된 텍스트 색상 또는 그에 준하는 접근성 색상 사용

### 5.3 반응형
- 데스크톱 우선(윈도우)
- 창 크기 변경 시 입력 영역이 자연스럽게 리플로우되도록 구성

---

## 6. 비기능 요구 사항(Non-Functional)

### 6.1 성능
- 일기 데이터 10,000건 수준에서도 저장/로딩이 사용자 체감상 원활해야 한다.
- 저장 버튼 클릭 후 1초 내 저장 완료 메시지 표시를 목표로 한다(일반 PC 기준).

### 6.2 안정성
- 저장 중 앱 강제 종료/전원 종료 시에도 파일이 깨지지 않도록 원자적 저장을 적용한다.
- 예외 발생 시 로그를 남기고(로컬) 사용자에게 이해 가능한 메시지를 제공한다.

### 6.3 프라이버시/보안
- 데이터는 외부 서버로 전송하지 않는다.
- 로컬 파일로만 저장한다.
- (추후 확장) 옵션으로 파일 암호화/비밀번호 잠금 추가 가능

### 6.4 호환성
- Windows 10/11 우선 지원
- (추후) macOS 지원 가능하도록 경로 추상화

---

## 7. 수용 기준(Acceptance Criteria)

1) 사용자가 20260101을 선택하고 내용을 저장하면 `diary.tsv`에 해당 날짜 행이 생성된다.  
2) 같은 날짜를 다시 열면 저장된 제목/내용이 정확히 로딩된다.  
3) 같은 날짜는 항상 동일한 배경색과 텍스트 색상을 표시한다.  
4) 제목/내용에 줄바꿈이 포함되어도 TSV 저장/로딩 후 원문이 보존된다.  
5) 저장 중 강제 종료가 발생해도 `diary.tsv`가 손상되지 않는다(원자적 저장 검증).

---

## 8. 향후 확장(Backlog)
- 날짜별 목록/캘린더 뷰
- 검색/필터
- 이미지 첨부(로컬 폴더 + 참조 링크 저장)
- 암호화(파일 단위 또는 항목 단위)
- 자동 백업/내보내기(Export)
